---
sidebar_position: 3
---

# 模型算子支持列表{#supported_op_list_and_restrictions}


## 使用限制说明

本章节主要介绍地平线处理器支持的 `Caffe` 和 `ONNX` 算子情况，其他未列出的算子因地平线处理器 bpu硬件限制，暂不支持。

**术语概念：**

-    BPU加速   ：地平线处理器可以进行加速的算子（一定约束条件下），如果不满足约束条件，则会在CPU进行计算

-    CPU计算   ：当前已经在地平线ARM CPU上进行优化的算子，支持onnx opset10与opset11。

-    CPU计算※   ：暂时未集成的CPU算子。


**其他注意事项：**

-   RDK X3所有BPU上运行的算子均遵守一般限制：input_batch ≤ 128。 

-   RDK Ultra所有BPU上运行的算子均遵守一般限制：1. 输入输出维度均为4，对于支持非四维情况的op，会在约束中显性标识； 2. shape：H,W,C ∈ [1, 65536]，N <= 4096；3. N x C x H x W <= 1G bytes。

-   支持 ``Caffe 1.0`` 基础算子以及常用扩展算子，支持onnx ``opset10`` 和 ``opset11`` 算子，对于无法满足BPU加速约束条件的算子将会退化到ARM CPU进行计算。

-   ``Cast`` , ``Constant`` , ``Dropout`` , ``Reshape`` , ``Squeeze`` , ``Unsqueeze`` , ``Shape`` 这些算子(OP)无法直接运行在BPU上，但在一些情况下（常量折叠）算法工具链会将其优化掉进而实现支持的效果。

-   标记为PyTorch的算子(OP)为官方的opset11不包含的算子，地平线算法工具链提供了导出脚本可以将其从PyTorch导出到地平线自定义的onnx OP中。

-   基于tensorlfow-onnx（https://github.com/onnx/tensorflow-onnx）转换工具，支持将 ``tensorlfow1.*`` 版本的算子稳定的转换到opset6-opset11版本的ONNX模型格式，但是 ``Tensroflow2.*`` 当前支持还属于实验版本。

-   关于OP主动量化被动量化的说明：一个符合本章节约束条件的OP仍然运行在CPU的主要原因是该OP属于被动量化OP，算法工具链会根据OP的计算特性和BPU底层逻辑等多方面考虑设计量化逻辑，当前量化逻辑分为：主动量化，被动量化，手动量化。量化逻辑更多信息请阅读：[**算法工具链中的主动量化和被动量化逻辑**](https://developer.horizon.ai/forumDetail/118364000835765793) 章节。


## RDK X3支持的Caffe算子列表

| **caffe算子名称**       | **CPU计算/BPU加速** | **X3 BPU支持约束** | **CPU支持约束** |
| - | --------------- | --------------- | ----------- |
| Convolution   | BPU加速 | Kernel宽高取值范围：HxW=[1,7]x[1,7]  <br/> 输入输出Channel取值范围(one group) <= 2048（对于非dilated、group、depthwise conv等普通卷积，可以放宽至<=4096）。  <br/> stride无限制。  <br/> Dilation取值范围：只支持设置为2的幂次方，且必须能够被stride整除。 <br/>h_dilated和w_dilated可以不同但要求h_diated<=w_dilated。  <br/> 单个Kernel总体大小限制: HxWxC <= 32768 。 <br/>不支持配置axis，默认为1 | 仅支持4维Conv计算。 <br/>auto_pad 属性不支持。 <br/>type约束支持：float,int32,int8。 <br/>pads属性约束：[Hstart, Wstart, Hend, Wend]（pads长度等于4）并且Hstart==Hend，Wstart==Wend。                                |
| Deconvolution | BPU加速 | Kernel 宽高取值范围：HxW=[2,14]x[2,14]。  <br/>输入输出Channel数值取值范围：C <= 2048。  <br/>Padding宽高取值范围： <br/>HxW=[0,(Kernel_H-1)/2]x[0,(Kernel_W-1)/2] 。 <br/>Stride取值范围：Stride ∈ {2, 4} 。 <br/>stride_h ≦ stride_w 。 <br/>Dilation ∈ {(1, 1)}。  <br/>不支持配置axis属性。 | 不支持output_shape和output_padding参数；  <br/>auto_pad参数只支持NOTSET模式；  <br/>不支持axis |
| MaxUnpool                                                    | CPU计算 | --- | from_type支持：   <br/>- X：type约束：仅支持float类型。  <br/>- I：Tensor（int64）。  <br/>to_type支持：type约束：仅支持float类型。                                       |
| Pooling      | BPU加速 | 共有四种Pooling算子即MaxPooling，AveragePooling，GlobalMaxPooling，GlobalAveragePooling。 <br/>对四种Pooling的约束分别为：   <br/>MaxPooling： <br/> Kernel宽高的取值范围为：[1,64]x[1,64] 。 <br/>Stride取值范围为：[1,185]。 <br/> Padding值需要大于等于零。 <br/>AveragePooling： <br/> Kernel HxW=[1, 7]x[1, 7], Stride ∈{1, 185}。  <br/>GlobalAveragePooling：  <br/>假设输入shape为NCHW， 则输入宽高需满足 HxW <= 8192 。 <br/>GlobalMaxPooling：  <br/>假设输入shape为NCHW，则输入宽高取值范围为HxW=[1,1024]x[1,1024]。 | 无  |
| SPP          | CPU计算 | 不支持                                                       | 支持pyramid_height，2^n 次pooling, n<7; <br/>pooling kernel 小于等于 255；  <br/>支持pool，配置可选值为{0，1} |
| InnerProduct | BPU加速 | InnerProduct将被转化为Conv实现。  <br/>假设InnerProduct的输入feature map的shape为NCHW ： <br/>1. 如果HW均小于等于7，则Gemm的限制等同于Conv。  <br/>2. 如果H和W均为1，那么C的限制为 <= 16384；否则 C的大小限制为 <= 2048。  <br/>3. 如果Gemm后是一个BPU支持的节点，Gemm会进行低精度int8输出，此时的输入宽高限制为: H x W/8 x C/4 <= 1024。  <br/>4. 如果Gemm后是一个非BPU支持的节点，Gemm会进行高精度int32输出，此时的输入宽高限制为: H x W/8 x C/4 < 2048 。 <br/> 不支持配置axis属性 | 无                                                           |
| LRN  | CPU计算 | 不支持 | local_size 支持、 <br/>alpha支持、 <br/>beta 支持、 <br/>norm_region 支持，配置可选值{ACROSS_CHANNELS, WITHIN_CHANNEL }、 <br/>k 支持 |
| MVN  | CPU计算 | 不支持 | normalize_variance支持，配置可选值为{0, 1}、 <br/>across_channels支持，配置可选值为{0, 1}、 <br/>仅支持Float32类型的计算。 |
| BatchNorm                                                    | BPU加速 | 无限制 | 无                                         |
| **ONNX Operator Name** | **CPU/BPU Acceleration** | **X3 BPU Constraint** | **CPU Constraint** |
| ------------ | --------------- | --------------- | ----------- |
| Abs                       | CPU computation         | --          | Type constraint: float only.   |  
| Acos                      | CPU computation         | --          | Type constraint: float only. |    
| Acosh                     | CPU computation         | --     | Type constraint: float only.      |    
| Add                       | BPU acceleration         | Input channel size M <= 2048 supported cases: <br/> 1. Add's two input shapes are NCHW and NCHW;  <br/>2. Add's two input shapes are NCHW and NC11 (both inputs of Add need to be outputs of other ops); <br/>3. Add as a short-cut substructure in ResNet, will be fused with the previous conv for accelerated computation. | - Support calculation with the same input shape. <br/>- Support input 1 is a scalar or input 2 is a scalar calculation. <br/>- Support broadcast calculation with a maximum dimension of 5. |          
| And                       | CPU computation         | --  | - Support calculation with the same input shape. <br/>- Support input 1 is a scalar or input 2 is a scalar calculation. <br/>- Support broadcast calculation with a maximum dimension of 5. |                      
| ArgMax                    | BPU acceleration         | 1. Four-dimensional input shape NCHW. <br/>2. Only support argmax along C dimension, i.e., axis = 1. <br/> 3. C <= 64 | Type constraint: float only.     |                       
| ArgMin                    | CPU computation         | --                                                           | Type constraint: float only.    |                         
| Asin                      | CPU computation         | --                                                           | Type constraint: float only.    |                         
| Asinh                     | CPU computation         | --                                                           | Type constraint: float only.   |                       | Atan                      | CPU computation      | --                                                           | type constraint: only supports float type.     |                       
| Atanh                     | CPU computation      | --                                                           | type constraint: only supports float type.     |                        
| AveragePool               | BPU acceleration      | Kernel HxW=[1, 7]x[1, 7], Stride ∈{1, 185}                   | auto_pad attribute not supported. <br/>Only supports four-dimensional tensor computation.     |                      
| BatchNormalization        | BPU acceleration      | Will be fused with the previous conv                              | type constraint: only supports float type.  <br/>Supports channel-first data layout calculation.   |         
| BitShift                  | CPU computation※        | --                                                           | --                                                           |     
| Cast                      | CPU computation      | --                                                           | from_type supports double, float, bool, int64, uint32, int32, uint16, int16, uint8, int8. <br/>to_type supports double, float, bool, int64, uint32, int32, uint16, int16, uint8, int8.|    
| Ceil                      | CPU computation      | --                                                           | type constraint: only supports float type.     | 
| Clip                      | BPU acceleration      | No restrictions                                                      | type constraint: only supports float type. <br/>When there are only two inputs, the default is min parameter. | 
| Compress                  | CPU computation※        | --                                                           | --                                                           |  
| Concat                    | BPU acceleration      | Input-output Channel: C<=2048                                    | --                                                          |  
| ConcatFromSequence        | CPU computation※        | --                                                           | --                                                           |   
| Constant                  | BPU acceleration      | Will be optimized by constant folding                                | Does not support sparse_tensor attribute. <br/>type constraint: only supports float type.                    |    
| ConstantOfShape           | BPU acceleration      | Will be optimized by constant folding                                 | type constraint: supports float, int32, int8.   |    
| Conv                      | BPU acceleration      | Kernel width and height range: HxW=[1,7]x[1,7]. <br/> Input and output channels range (one group) <= 2048(can be relaxed to <=4096 for non-dilated, group, depthwise conv, etc.). <br/> Stride: unlimited, but if Conv is followed by Add (resnet shortcut-connecting), stride has the range of {1, 2}. <br/> Dilation: supports only powers of 2 and must be divisible by stride. <br/> h_dilated and w_dilated can be different but requires h_dilated <= w_dilated. <br/> Overall limit for a single kernel: HxWxC <= 32768 | Only supports 4-dimensional Conv computation. <br/>auto_pad attribute not supported. <br/>type constraint: supports float, int32, int8. <br/>pads attribute constraint: [Hstart, Wstart, Hend, Wend] (pads length = 4) and Hstart==Hend, Wstart==Wend.|   
| ConvInteger               | CPU computation※        | --                                                           | --                                                           | 
| ConvTranspose             | BPU acceleration      | Kernel width and height range: HxW=[2,14]x[2,14]. <br/> Input and output channels range: C <= 2048. <br/> Padding width and height range: HxW=[0,(Kernel_H-1)/2]x[0,(Kernel_W-1)/2]. <br/> Stride range: Stride ∈ {2, 4}. <br/> stride_h ≦ stride_w. <br/> Dilation ∈ {(1, 1)} | auto_pad attribute not supported.  <br/>type constraint: supports float, int32, int8. |  
| Cos                       | BPU acceleration      | For an input tensor with dimension 1CHW, only supports CxHxW <= 8192        | type constraint: only supports float type.            |   
| Cosh                      | CPU computation      | --                                                           | type constraint: only supports float type.      |    
| CumSum                    | CPU computation      | --                                                           | from_type: <br/>x: type constraint only supports float type. <br/>axis: type constraint only supports int32 type. <br/>to_type: type constraint only supports float type. |   
| DepthToSpace              | BPU acceleration      | Supports mode=DCR and mode=CRD. <br/> Only supports rearrangement of H and W dimensions, and only supports reshaping with blocksize=2.  <br/>Example: NxCxHxW -> Nx(C/4)x(2H)x(2W) | from_type supports: <br/>- type constraint only supports float type. <br/>- only supports 4-dimensional Tensor computation. <br/>to_type supports: <br/>- type constraint only supports float type. <br/>- only supports 4-dimensional Tensor computation.  | 
| DequantizeLinear          | CPU computation        | --                                                           | --                                                           |   
| Det                       | CPU computation※        | --                                                           | --                                                           |   
| Div                       | BPU acceleration      | 1. Only supports both inputs as feature maps (does not support inputs from constants). <br/>2. Please refer to Mul operator for input shape constraints    | - Supports calculation with the same input shape. <br/>- Supports calculation with one input being a scalar or one input being a scalar. <br/>- Supports broadcast calculation, with a maximum dimension of 5. |  
| Dropout                   | BPU acceleration      | This operator does not participate in calculation during inference and will be removed during optimization                                   | --                                                           |   
| Einsum                    | CPU computation※        | --                                                           | --                                                           |  
| Elu                       | CPU computation      | --                                                           | type constraint: only supports float type.   |  
| Equal                     | CPU computation      | --                                                           | - Supports calculation with the same input shape. <br/>- Supports calculation with one input being a scalar or one input being a scalar. <br/>- Supports broadcast calculation, with a maximum dimension of 5.   |    
| Erf                       | CPU computation        | --                                                           | type constraint: supports float, double data types.                               |     
| Exp                       | BPU acceleration      | --                                                           | type constraint: only supports| LSTM                      | BPU Acceleration   | Only supports batch_size=1                                             | - Attribute setting not supported. <br/>- Type constraint only supports float type. <br/>- Only supports input shape of 3, 4, or 8. <br/>- Output shape is 2. |   
| LeakyRelu                 | BPU Acceleration   | None                                                                   | None                                                                   | 
| Less                      | CPU Calculation    | --                                                                     | - Supports calculation with same input shape. <br/>- Supports calculation with input1 as scalar or input2 as scalar. <br/>- Supports broadcast calculation, with a maximum dimension of 5. | 
| LessOrEqual               | CPU Calculation    | --                                                                     | - Supports calculation with same input shape. <br/>- Supports calculation with input1 as scalar or input2 as scalar. <br/>- Supports broadcast calculation, with a maximum dimension of 5.  |  
| Log                       | CPU Calculation    | --                                                                     | Type constraint: Only supports float type.    | 
| LogSoftmax                | CPU Calculation    | --                                                                     | Type constraint: Only supports float type.    | 
| Loop                      | CPU Calculation※   | --                                                                     | --                                                                   |  
| LpNormalization           | CPU Calculation    | --                                                                     | - Lp norm only supports 1 or 2. <br/>- Type constraint supports double type and float type.|  
| LpPool                    | CPU Calculation    | --                                                                     | - auto_pad attribute not supported. <br/>- Type constraint supports double type and float type. <br/>- Only supports 4-dimensional calculation. |  
| MatMulInteger             | CPU Calculation※   | --                                                                     | --                                                                   |    
| MatMul                    | BPU Acceleration   | For scenarios where the two inputs are featuremap and weight (i.e., featuremap multiplied by a constant), the following scenarios can be optimized to run on BPU: <br/>- K vs KxN, K vs 1xKxN, K vs 1x1xKxN <br/>- MxK vs K, MxK vs KxN, MxK vs 1x1xKxN <br/>- 1xMxK vs K, 1xMxK vs 1xKxN <br/>- 1x1xMxK vs K, 1x1xMxK vs 1xKxN, 1x1xMxK vs 1x1xKxN <br/>- BxMxK vs KxN (B>=1) <br/>- 1xBxMxK vs KxN (B>=1) <br/>- AxBxMxK vs KxN (A>1, B>1) <br/>For scenarios where the first input is weight and the second input is featuremap, the following scenarios can be optimized to run on BPU: <br/>- 1xBxMxK vs 1x1xKxN (B>1) <br/>For scenarios where both inputs are featuremap (i.e., two featuremaps multiplied together), the following scenarios can be optimized to run on BPU: <br/>- 1xBxMxK vs 1x1xKxN (B>=1) | Type constraint: Only supports float type.  |  
| Max                       | CPU Calculation    | --                                                                     | - Supports 1-∞ inputs. <br/>- Supports calculation with same input shape. <br/>- Supports calculation with input1 as scalar or input2 as scalar. <br/>- Supports broadcast calculation, with a maximum dimension of 5. |  
| MaxPool                   | BPU Acceleration   | Kernel width and height should be in the range of [1, 64]. <br/> Stride should be in the range of [1,185]. <br/>Padding value must be| ReverseSequence           | CPU计算         | --                                                           | --                                                           |
| RoiAlign                  | CPU计算         | --                                                           | --                                                           |
| Round                     | CPU计算        | --                                                           | --                                                           |
| Scan                      | CPU计算※        | --                                                           | --                                                           |
| Scatter (deprecated)      | CPU计算※        | --                                                           | --                                                           |
| ScatterElements           | CPU计算         | --                                                           | from_type支持： <br/>- data：type约束支持：float,int32,int8。 <br/>- indices：type约束仅支持int32类型。 <br/>- updates：type约束支持：float,int32,int8。 <br/>to_type支持：type约束支持：float,int32,int8。  |
| ScatterND                 | CPU计算         | --                                                           | from_type支持： <br/>- data：type约束支持：float,int32,int8。 <br/>- updates : type约束支持：float,int32,int8。 <br/>to_type支持：type约束支持：float,int32,int8。   |
| Selu                      | CPU计算         | --                                                           | type约束：仅支持float类型。    |
| SequenceAt                | CPU计算※        | --                                                           | --                                                           |
| SequenceConstruct         | CPU计算※        | --                                                           | --                                                           |
| SequenceEmpty             | CPU计算※        | --                                                           | --                                                           |
| SequenceErase             | CPU计算※        | --                                                           | --                                                           |
| SequenceInsert            | CPU计算※        | --                                                           | --                                                           |
| SequenceLength            | CPU计算※        | --                                                           | --                                                           |
| Shape                     | BPU加速         | 会通过常量折叠将其优化为数值存储                               | --  |
| Shrink                    | CPU计算※        | --                                                           | --                                                           |
| Sigmoid                   | BPU加速         | 对于一个输入维度为1CHW的tensor，仅支持min(8W4C对齐后的shape，32C对齐后的shape) <=8192的情况。 <br/>8W4C：实际运行时tensor的W维度padding至8的整数倍，C维度padding至4的整数倍。 <br/>32C：实际运行时tensor的C维度padding至32的整数倍。 <br/>在两个对齐方式中取对齐后shape最小值，判断是否<=8192。    | type约束：仅支持float类型。   |
| Sign                      | CPU计算         | --                                                           | 无                                                           |
| Sin                       | BPU加速         | 对于一个输入维度为1CHW的tensor，仅支持CxHxW <= 8192的情况       | type约束：仅支持float类型。     |
| Sinh                      | CPU计算         | --                                                           | type约束：仅支持float类型。     |
| Size                      | BPU加速         | 会通过常量折叠将其优化为数值存储                            | --                                                           |
| Slice                     | BPU加速         | 无限制                                                       | 无                                                           |
| Softmax                   | BPU加速         | 默认运行在CPU上，当该op输入为四维且axis=1，并且作为模型输出节点时，可以通过run_on_bpu指定该节点将其运行在BPU上。 | type约束：仅支持float类型。  |
| Softplus                  | BPU加速         | 对于一个输入维度为1CHW的tensor，仅支持CxHxW <= 8192的情况    | type约束：仅支持float类型。  |
| Softsign                  | CPU计算         | --                                                           | type约束：仅支持float类型。       |
| SpaceToDepth              | BPU加速         | 支持mode=DCR 和 mode=CRD。 <br/> 仅支持H和W方向的重新排列，并且仅支持blocksize=2的重排列。  <br/>举例：NxCxHxW -> Nx(4C)x(H/2)x(W/2) | type约束：仅支持float类型。    |
| Split                     | BPU加速         | 1. 只支持输入大小为NCHW；  <br/>2. 原始输入的长度必须是每个被切分的tensor长度的倍数；  <br/>3. 只支持沿着C，H，W维度的切分，也就是axis支持等于1，2，3；  <br/>4. split数应可以整除 | type约束：仅支持float类型。    |
| SplitToSequence           | CPU计算※        | --                                                           | --                                                           |
| Sqrt                      | BPU加速         | 对于一个输入维度为1CHW的tensor，仅支持CxHxW <= 8192的情况            |type约束：仅支持float类型。   |
| Squeeze                   | CPU计算         | 如果该op出现在模型中的常量计算子结构中，会被常量折叠优化删除掉，不参与推理      | --                                                          |            |
| StringNormalizer          | CPU计算※        | --                                                           | --                                                           |
| Sub                       | CPU计算         | --                                                           | - 支持相同输入shape计算。 <br/>- 支持输入1是标量或者输入2是标量的计算。 <br/>- 支持broadcast计算，最大维度是5。  |
| Sum                       | BPU加速         | 限制条件等同于Add                                            | type约束：仅支持float类型。   |   
| Tan                       | CPU计算         | --                                                           | type约束：仅支持float类型。   |
| Tanh                      | BPU加速         | 对于一个输入维度为1CHW的tensor，仅支持CxHxW <= 8192的情况       | type约束：仅支持float类型。   |
| TfIdfVectorizer           | CPU计算※        | --                                                           | --                                                           |
| ThresholdedRelu           | CPU计算         | --                                                           | type约束：仅支持float类型。  |
| Tile                      | CPU计算         | --                                                           | type约束：仅支持float,int64,int32,uint64,uint32类型。   |
| TopK                      | CPU计算         | --                                                           | - type约束：仅支持float类型。  <br/>- 仅支持opset-10。  |
| Transpose                 | CPU计算         | --                                                            | - 支持nhwc2nchw，perm：[0, 3, 1, 2]。 <br/>- 支持nchw2nhwc，perm：[0, 2, 3, 1]。 <br/>- 支持指定perm维度转换，数据类型仅支持float，int8，int32。   |
| Unique                    | CPU计算※        | --                                                           | --                                                           |
| Unsqueeze                 | CPU计算         | 如果该op出现在模型中的常量计算子结构中，会被常量折叠优化删除掉，不参与推理        | --                                                          |
| Upsample (resize替代)     | BPU加速          | --                                                           | Upsample-(resize-10)  <br/>- 输入等于2时，使用opset10。 <br/>- 输入数据是4维Tensor。  <br/>Upsample-(resize-11)   <br/>- 输入大于2时，使用opset11。 <br/>- 输入数据是4维Tensor。 <br/>- coordinate_transformation_mode在nearest, linear模式下支持half_pixel, asymmetric, align_corners和pytorch_half_pixel四种，在cubic模式下只支持half_pixel。 <br/>- extrapolation_value属性不支持。  |
| Where                     | CPU计算         | --                                                           | type约束支持float和int64类型。 <br/> condition的shape为cond_shape，X的shape为x_shape，Y的shape为y_shape ，output的shape为o_shape，shape约束如下： <br/>- 仅支持cond_shape == o_shape情况下：   <br/>- x_shape == o_shape的broadcast。   <br/>- y_shape == o_shape的broadcast。 <br/>- 仅支持cond_shape.NDim() == 4 && o_shape.NDim() == 4 && N维度值相同 && C维度值相同：   <br/>- 1x1（cond_shape）与HxW （o_shape）。   <br/>- Hx1（cond_shape）与HxW（o_shape）。   <br/>- 1xW（cond_shape）与HxW（o_shape）。 |
| Xor                       | CPU计算※        | --                                                           | --                                                           |
| Function                  | CPU计算※        | --                                                           | --                                                           |
| Celu                      | CPU计算※        | --                                                           | --                                                           |
| DynamicQuantizeLinear     | CPU计算※        | --                                                           | --                                                           |
| GreaterOrEqual            | CPU计算        | --    | - 支持相同输入shape计算。 <br/>- 支持输入1是标量或者输入2是标量的计算。 <br/>- 支持broadcast计算，最大维度是5。 |
| MeanVarianceNormalization | CPU计算※        | --                                                           | --                                                           |
| GridSample (PyTorch) | CPU computation ※ | -- | |
| ------------------- | ---------------- | -- | - |
| RDK Ultra-supported Caffe Operators List |

| **Caffe Operator Name** | **CPU Computation / BPU Acceleration** | **RDK Ultra BPU Constraint** | **CPU Constraint** |
| ------------------------ | ----------------------------------- | -------------------------- | ----------------- |
| Convolution                    | BPU Acceleration                             | Kernel size restriction: <=32. <br/> Input/output channel value range (one group) <= 8192. If Conv is the last operator of the quantized subgraph, the value range should be <= 65536. <br/> Stride has no restriction, but for Conv followed by Add (resnet shortcut-connecting), the value range of stride is {1, 2}. <br/> Dilation restriction: <= 16. <br/> When dilation != 1, stride can only be 1. <br/> Axis configuration is not supported and the default## List of ONNX Operators Supported by RDK Ultra

| **ONNX Operator Name** | **CPU Calculation/BPU Acceleration** | **RDK Ultra BPU Constraints** | **CPU Constraints** |
| ------------ | --------------- | --------------- | ----------- |
| Abs                       | BPU Acceleration         | 1. This operator supports int16 input and output.<br/>2. Input and output support 1-10 dimensions, with the highest dimension ∈ [1, 4096], and other dimensions ∈ [1, 65536].| Type constraint: Only supports float type.   |  
| Acos                      | CPU Calculation         | --          | Type constraint: Only supports float type. |    
| Acosh                     | CPU Calculation         | --     | Type constraint: Only supports float type.      |    
| Add                       | BPU Acceleration         | 1. This operator supports int16 input and output.<br/>2. Input types support feature maps and constants, with support for up to one constant input.<br/>3. Supports broadcasting except for the first dimension, and supports broadcasting between the two inputs, such as NH1C and N1WC.<br/>4. Input and output dimensions support 2D, 3D, 4D, and 5D, with sizes subject to general restrictions (see notes). When the input dimensions are different and are 5D, the following restrictions must be met:<br/>(1) First, the adjacent dimensions can be merged to reduce the dimensions to 4D, for example, NHWD1 and N1WDC can merge the W and D dimensions to reduce the dimensions;<br/>(2) Secondly, the dimensions of the broadcast cannot be merged with the adjacent dimensions. For example, NHWD1 and N11DC cannot be supported because the H, W, and C dimensions are all broadcast dimensions| GRU                       | CPU计算         | --                                                           | - direction属性仅支持forward类型。<br/>- type约束：仅支持float类型。  | 
| Gather                    | BPU加速         | 1. input/output/indices 的rank都要小于等于4。<br/>2. indices支持：<br/>    - indices是feature（其他op输出）时，type约束仅支持int32类型。<br/>    - indices是weight（模型保存的常量）时，type约束支持int32和int64类型。 | from_type支持：<br/>- input：type约束支持：<br/>float,int64,int32,int8,uint64,uint32,uint8。<br/>- indices：type约束支持int32, int64。 <br/>to_type支持：type约束支持：<br/>float,int64,int32,int8,uint64,uint32,uint8。 |
| GatherElements            | BPU加速        | 1. 该算子支持int16输入输出。<br/>2. input/indices/output维度支持1-10维。<br/>3. indices type约束支持int16/int32/int64。 | --     |   
| GatherND                  | CPU计算         | --                          | from_type支持：<br/>- input：type约束支持float,int32,int8。<br/>- indices：tensor(int64)。<br/>to_type支持：type约束支持float,int32,int8。|    
| Gemm                      | BPU加速         | Gemm将被转化为Conv实现，边界约束参考Conv。 | type约束：仅支持float类型。    |  
| GlobalAveragePool         | BPU加速         | 无限制。           | - type约束：仅支持float类型。<br/>- 仅支持四维Tensor。| 
| GlobalLpPool              | CPU计算        | --                                                           | - type约束：支持float和double类型。<br/> - 仅支持四维Tensor计算。 |  
| GlobalMaxPool             | BPU加速         | H, W ∈ [1, 256]。 | - type约束仅支持float类型。<br/>- 仅支持四维Tensor。 |   
| Greater                   | BPU加速         | 1. 该算子支持int16输入。<br/>2. 输入输出维度支持2-5维。<br/>3. 支持所有维度的广播，支持fin0或fin1其中一个输入的广播，不能支持互相广播，5维广播时有以下限制：<br/>（1）需要能够合并相邻维度降到4维（包括维度N），例如NHWDC和NH1D1可以合并NH维来降维。<br/>（2）广播的维度不能和相邻维度合并，例如NHWDC和N1W1C因为无法合并相邻维度，所以无法支持。<br/>4. 默认运行在CPU上，可以通过run_on_bpu指定该节点将其运行在BPU上。 | - 支持相同输入shape计算。<br/>- 支持输入1是标量或者输入2是标量的计算。<br/>- 支持broadcast计算，最大维度是5。 | 
| HardSigmoid               | BPU加速         | 1. 该算子支持int16输入输出。<br/>2. 输入输出支持1-10维，最高维 ∈ [1, 4096]，其它维 ∈ [1, 65536]。 | type约束仅支持float类型。  |   
| Hardmax                   | CPU计算※        | --                                                           | --                                                           |  
| Identity                  | CPU计算         | --                                                           | --                                                         |    
| If                        | CPU计算※        | --                                                           | --                                                           |  
| InstanceNormalization     | CPU计算         | --                                                           |- type约束仅支持float类型。<br/>- 支持第1个维度是channel的数据排布方式计算。   |  
| IsInf                     | CPU计算※        | --                                                           | --                                                           |   
| IsNaN                     | CPU计算※        | --                                                           | --                                                           |   
| LRN                       | CPU计算         | --                                                           | - type约束仅支持float类型。<br/>- 仅支持四维Tensor。  | 
| LSTM                      | BPU加速         | 仅支持batch_size=1，如果需要配置多batch，需要在导出onnx时保证LSTM的batch为1并在yaml中配置参数input_batch=1。 | - type约束仅支持float类型。<br/>- 属性约束：direction属性仅支持forward。<br/>- 输入约束：<br/>   - 支持X、W、R输入配置；<br/>   - 支持X、W、R、B输入配置（sequence_lens为空或默认值）；<br/>   -  支持X、W、R、B、sequence_lens、initial_h、initial_c、P输入配置（sequence_lens为空或者默认值）。 |   
| LeakyRelu                 | BPU加速         | 1. 该算子支持int16输入输出。<br/>2. 输入输出支持1-10维，最高维 ∈ [1, 4096]，其它维 ∈ [1, 65536]。| type约束：仅支持float类型。  | 
| Less                      | BPU加速        | 1. 该算子支持int16输入。<br/>2. 输入输出维度支持2-5维。<br/>3. 默认运行在CPU上，可以通过run_on_bpu指定该节点将其运行在BPU上。 | - 支持相同输入shape计算。<br/>- 支持输入1是标量或者输入2是标量的计算。<br/>- 支持broadcast计算，最大维度是5。| 
| LessOrEqual               | BPU加速         |opset11 不支持单个LessOrEqual算子，支持拆分后的算子Greater+Not运行在BPU上，限制条件与Greater相同。|- 支持相同输入shape计算。<br/>- 支持输入1是标量或者输入2是标量的计算。<br/>- 支持broadcast计算，最大维度是5。  |  
| Log                       | BPU加速         | 1. 该算子支持int16输入输出。<br/>2. 输入输出支持1-10维，最高维 ∈ [1, 4096]，其它维 ∈ [1, 65536]。 | type约束：仅支持float类型。    | 
| LogSoftmax                | CPU计算         | --                                                           | type约束：仅支持float类型。    | 
| Loop                      | CPU计算※        | --                                                           | --                                                           |  
| LpNormalization           | CPU计算        | --                                                           | - p范数仅支持1或者2。<br/>- type约束支持double类型和float类型。|  
| LpPool                    | CPU计算        | --                                                           | - auto_pad属性不支持。<br/>- type约束支持double类型和float类型。<br/>- 仅支持4维计算。 |  
| MatMulInteger             | CPU计算※        | --                                                           | --                                                           |    
| MatMul                    | BPU加速         | C = MatMul(A，B)，对输入A和输入B有以下维度限制：<br/>- A和B均支持非四维输入但需满足约束：<br/>  - A和B的维度必须相同。<br/>  - A和B的最低两个维度M, K∈[1, 8192]，其他更高维度∈[1, 4096]。    <br/>  注：HDMK vs HDKN，MK/KN即为最低两个维度。<br/>- 支持的broadcast需满足以下条件：<br/>  - A跟B两个输入，除开最低两维的其他维度全是1或者全是不需要广播的值。<br/>    - 此场景支持的例子：HDMK vs H1KN<br/>    - 此场景不支持反例：H1MK vs 1DKN<br/>  - A除了最低两个维度，其他维度不能即有需要广播的值也有不需要广播的值。<br/>    - 此场景支持的例子：11MK vs HDKN<br/>    - 此场景不支持反例：H1MK vs HDKN<br/>  - B除了最低两个维度，如果其他维度即有需要广播的值也有不需要广播的值，那么不需要广播的值只能在连续的高维度上。<br/>    - 此场景支持的例子：BHDMK vs B11KN<br/>    - 此场景不支持反例：BHDMK vs B1DKN  <br/>  注：需要广播的值和不需要广播的值：<br/>    - 如果A和B在对应维度轴上的两个值，一个为1，另一个为非1，那么1就是需要广播的值，非1就是不需要广播的值；<br/>    - 如果A和B在对应维度轴上的两个值相等，那么这两个值都是不需要广播的值（如HDMK vs H1KN，1是需要广播的值，H是不需要广播的值） | type约束：仅支持float类型。  |  
| Max                       | BPU加速         | 1.该算子支持int16输入输出。<br/>2.输入输出维度支持2-5维。<br/>3.支持所有维度的广播，支持fin0或fin1其中一个输入的广播，不能支持互相广播，5维广播时有以下限制：<br/>（1）需要能够合并相邻维度降到4维（包括维度N），例如NHWDC和NH1D1可以合并NH维来降维。<br/>（2）广播的维度不能和相邻维度合并，例如NHWDC和N1W1C因为无法合并相邻维度，所以无法支持。 | - 支持1-∞个输入。<br/>- 支持相同输入shape计算。<br/>- 支持输入1是标量或者输入2是标量的计算。<br/>- 支持broadcast计算，最大维度是5。 |  
| MaxPool                   | BPU加速         | 该算子支持int16输入输出。<br/>kernel <= 256。<br/>stride <= 256。<br/>padding <= 256。<br/>MaxPool不支持dilation。 | 1. dilation只支持1x1。<br/>2. 只支持数据行优先存储。<br/>3. auto_pad属性不支持。<br/>4. storage_order属性不支持。<br/>5.仅支持四维Tensor计算。|   
| MaxRoiPool                | CPU计算         | --                                                           | 无                                                           |   
| Mean                      | CPU计算※        | --                                                           | --                                                           | 
| Min                       | BPU加速        | 1.该算子支持int16输入输出。<br/>2.输入输出维度支持2-5维。<br/>3.支持所有维度的广播，支持fin0或fin1其中一个输入的广播，不能支持互相广播，5维广播时有以下限制：<br/>（1）需要能够合并相邻维度降到4维（包括维度N），例如NHWDC和NH1D1可以合并NH维来降维。<br/>（2）广播的维度不能和相邻维度合并，例如NHWDC和N1W1C因为无法合并相邻维度，所以无法支持。<br/>4. 默认运行在CPU上，可以通过run_on_bpu指定该节点将其运行在BPU上。| - 支持1-∞个输入。<br/>- 支持相同输入shape计算。<br/>- 支持输入1是标量或者输入2是标量的计算。<br/>- 支持broadcast计算，最大维度是5。 |  
| Mod                       | CPU计算※        | --                                                           | --                                                           | 
| Mul                       | BPU加速         | 1. 该算子支持int16输入输出。<br/>2.输入类型支持featurmap和常量，且最多支持一个常量输入。<br/>3.支持除第一维外的广播，支持两个输入之间的互相广播，例如NH1C和N1WC。<br/>4.输入输出维度支持2维、3维、4维和5维，大小为一般限制（见备注）。支持两个输入维度不同，输入为5维时需要满足以下限制：<br/>(1)首先可以通过合并相邻维度降维到4维，例如NHWD1和N1WDC可以合并W维和D维来降维；<br/>(2)其次广播的维度不能和相邻维度合并，例如NHWD1和N11DC因为H维、W维和C维都是广播的维度，无法通过合并相邻维度降维，所以无法支持。 | - 支持相同输入shape计算。<br/>- 支持输入1是标量或者输入2是标量的计算。<br/>- 支持broadcast计算，最大维度是5。 |    
| Multinomial               | CPU计算※        | --                                                           | --                                                           |   
| Neg                       | CPU计算        | --                                                           | --                                                        |  
| Not                       | CPU计算        | --                                                           | --                                                           |  
| OneHot                    | CPU计算        | --                                                           | --                                                        |   
| Or                        | CPU计算         | --                                     | - 支持相同输入shape计算。<br/>- 支持输入1是标量或者输入2是标量的计算。 <br/>- 支持broadcast计算，最大维度是5。|   
| PRelu                     | CPU计算         | --                                                        | - type约束支持：仅支持float类型。<br/>- from_type：X和slope。<br/>- to_type：Y。<br/>- X的shape为data_shape，slope的为slope_shape ，shape约束如下：  <br/>- data_shape == slope_shape。   <br/>- slope_shape.ProdSize() == 1。   <br/>- X和slope仅支持NCHW排布的4维度计算，并且N、C维度值相等。     <br/>- HxW 与1x1（ slope_shape ）。     <br/>- HxW与Hx1（ slope_shape ）。     <br/>- HxW与1xW（ slope_shape ）。 <br/>- X是4维度 && slope是3维度 && data_shape[1] == slope_shape [0] && slope_shape [1] == 1 && slope_shape [2] == 1。  |                         |
| Pad                       | BPU加速         | 1. 该算子支持int16输入输出。<br/>2. 支持mode = Constant。<br/>3. 支持所有维度的Pad。 | Pad-10：<br/>- type约束仅支持float类型。<br/>- 仅支持NCHW排布的4维Tensor。<br/>- 属性pads的约束如下：  <br/>- len(pads) == 8 && pads[i] >=0 && pads[0] == 0 && pads[1] == 0 && pads[4] == 0 && pads[5] == 0。 <br/>Pad-11：<br/>- from_type支持：  <br/>- data：type约束仅支持float类型。  <br/>- pads : tensor(int64)。  <br/>- constant_value (optional)：type约束仅支持float类型。<br/>- to_type支持：type约束仅支持float类型。<br/>- 仅支持4维Tensor。<br/>- 仅支持2/3维度填充。 |   
| Pow                       | BPU加速         | 1. 该算子支持int16输入输出。<br/>2. 输入输出支持1-10维，最高维 ∈ [1, 4096]，其它维 ∈ [1, 65536]。<br/>3. 第二个输入只支持标量。  | - type约束支持：double, float，int64, int32。<br/>- 支持相同输入shape的计算。<br/>- 支持输入1是标量或者输入2是标量的计算。<br/>- 支持broadcast计算，最大维度是5。<br/>- 仅支持X和Y相同type。 |  
| QLinearConv               | CPU计算※        | --                                                           | --                                                           |   
| QLinearMatMul             | CPU计算※        | --                                                           | --                                                           |
| QuantizeLinear            | CPU计算          | --                                                           | --                                                           |
| RNN                       | CPU计算         | --                                                           | - type约束：仅支持float类型。<br/>- 属性约束：direction属性仅支持forward。<br/>- 输入约束：仅支持X、W、R输入，不支持可选输入B、sequence_lens、initial_h设置。 <br/>- 输出约束：仅支持Y_h的输出，shape [num_directions, batch_size, hidden_size]。 |
| RandomNormal              | CPU计算※        | --                                                           | --                                                           |
| RandomNormalLike          | CPU计算※        | --                                                           | --                                                           |
| RandomUniform             | CPU计算         | --                                                           | --                                                           |
| RandomUniformLike         | CPU computation         | --                                                           | --                                                           |
| Range                     | CPU computation         | --                                                           | type constraints supported: float, int64, int32, int16.            |
| Reciprocal                | BPU acceleration         | 1. This operator supports int16 input and output.<br/>2. The input and output support 1-10 dimensions, with the highest dimension ∈ [1, 4096] and the other dimensions ∈ [1, 65536]. | --                                                           |
| ReduceL1                  | CPU computation         | --                                                           | --                              |
| ReduceL2                  | CPU computation         | --                                                           | --       |
| ReduceLogSum              | CPU computation         | --                                                           | --                         |
| ReduceLogSumExp           | CPU computation         | --                                                           | type constraints supported: float, double data types.               |
| ReduceMax                 | BPU acceleration         | 1. This operator supports int16 input and output.<br/>2. The input supports 2-5 dimensions and requires to specify the axes attribute. The number of axes specified is 1, and it does not support reduce operations along more than one dimension.<br/>3. The size of the reduce axis's dimension ∈ [1, 8192].<br/>4. Only support keepdims == 1. | axes support 0, 1, or the number of dimensions of the input data.                           |
| ReduceMean                | BPU acceleration         | 1. This operator supports int16 input and output.<br/>2. The input supports 2-5 dimensions and requires to specify the axes attribute. The number of axes specified is 1, and it does not support reduce operations along more than one dimension.<br/>3. For reduce dimension = 2, it supports reduce along both HW dimensions simultaneously.<br/>4. Only support keepdims == 1. | axes support 0, 1, or the number of dimensions of the input data.                           |
| ReduceMin                 | CPU computation         | --                                                           | --                                                           |
| ReduceProd                | CPU computation         | --                                                           | --                                                           |
| ReduceSum                 | BPU acceleration         | 1. This operator supports int16 input and output.<br/>2. The input supports 2-5 dimensions and requires to specify the axes attribute. The number of axes specified is 1, and it does not support reduce operations along more than one dimension. | axes support 0, 1, or the number of dimensions of the input data.  |
| ReduceSumSquare           | CPU computation         | --                                                           | axes support 0, 1, or the number of dimensions of the input data.                           |
| Relu                      | BPU acceleration         | No constraints                                               | type constraints: only support float type.      |  
| Reshape                   | BPU acceleration         | 1. This operator supports int16 input and output.<br/>2. Supports 1-10 dimensional input and output.  | --                                                         |
| Resize                    | BPU acceleration         | 1. The input feature map must be four-dimensional NCHW and only supports resize on dimensions H and W. When onnx opset=11, ROI input is supported (model converted from PyTorch needs to manually add ROI input to the operator, and ROI only supports constant input). ROI input only supports dimensions H and W, and the ROI input only works in tf_crop_and_resize mode.<br/>2. The mode attribute supports two modes: nearest and linear.<br/>3. Supports scaling up and down.<br/>4. For mode=nearest, the scaling factor factor supports powers of 2 such as 2, 4, 8, 16, 32, etc. The scaling factors for dimensions H and W can be different but must satisfy H_factor <= W_factor.<br/>5. For onnx opset=11, the coordinate_transformation_mode attribute supports half_pixel, pytorch_half_pixel, asymmetric, align_corners, and tf_crop_and_resize. When coordinate_transformation_mode=tf_crop_and_resize, ensure that the boundary coordinates obtained from the ROI input conversion are integers. | resize-10 <br/>- Use opset10 when input is equal to 2.<br/>- Input data is a 4-dimensional tensor. <br/>resize-11  <br/>- Use opset11 when input is greater than 2.<br/>- Input data is a 4-dimensional tensor.<br/>- The coordinate_transformation_mode supports four types: half_pixel, asymmetric, align_corners, and pytorch_half_pixel for nearest and linear modes, and only supports half_pixel for cubic mode.<br/>- The extrapolation_value attribute is not supported. |
| ReverseSequence           | CPU computation         | --                                                           | --                                                           |
| RoiAlign                  | CPU computation         | --                                                           | --                                                           |
| Round                     | CPU computation        | --                                                           | --                                                           |
| Scan                      | CPU computation※        | --                                                           | --                                                           |
| Scatter (deprecated)      | CPU computation※        | --                                                           | --                                                           |
| ScatterElements           | CPU computation         | --                                                           | from_type supports:<br/>- data: type constraints supported: float, int32, int8.<br/>- indices: type constraints supported: int32 only.<br/>- updates: type constraints supported: float, int32, int8.<br/>to_type supports: type constraints supported: float, int32, int8.  |
| ScatterND                 | CPU computation         | --                                                           | from_type supports:<br/>- data: type constraints supported: float, int32, int8.<br/>- updates: type constraints supported: float, int32, int8.<br/>to_type supports: type constraints supported: float, int32, int8.   |
| Sel| Tanh                      | BPU Acceleration | 1. This operator supports int16 input and output. <br/>2. Input and output support 1-10 dimensions, with the highest dimension ∈ [1, 4096], and other dimensions ∈ [1, 65536].
| type constraint: only supports float type. |
| TfIdfVectorizer           | CPU Calculation※ | --                                                           | --                                                           |
| ThresholdedRelu           | CPU Calculation | --                                                           | type constraint: only supports float type.  |
| Tile                      | BPU Acceleration | 1. This operator supports int16 input and output. <br/>2. Only one dimension of the input and output is allowed to have different values. | type constraint: only supports float, int64, int32, uint64, uint32 types.   |
| TopK                      | BPU Acceleration | 1. This operator supports int16 input and output. <br/>2. input/indices/output dimensions support 1-10 dimensions. <br/>3. indices type constraint supports int16/int32/int64. <br/>4. parameter sorted only supports true. | - type constraint: only supports float type.|
| Transpose                 | BPU Acceleration | 1. This operator supports int16 input and output. <br/>2. Supports arbitrary input dimensions. | - Supports nhwc2nchw, perm: [0, 3, 1, 2].<br/>- Supports nchw2nhwc, perm: [0, 2, 3, 1].<br/>- Supports dimension conversion with specified perm, data types only support float, int8, int32.   |
| Unique                    | CPU Calculation※ | --                                                           | --                                                           |
| Unsqueeze                 | BPU Acceleration | This op will be transformed into Reshape, BPU constraints refer to Reshape op.       | --                                                          |
| Upsample (replace with resize)     | BPU Acceleration          | --                                                           | Upsample-(resize-10) <br/>- When input equals 2, use opset10. <br/>- Input data is a 4D Tensor. <br/>Upsample-(resize-11)  <br/>- When input is greater than 2, use opset11. <br/>- Input data is a 4D Tensor. <br/>- coordinate_transformation_mode supports half_pixel, asymmetric, align_corners, and pytorch_half_pixel in nearest, linear modes, and only supports half_pixel in cubic mode. <br/>- extrapolation_value attribute is not supported.  |
| Where                     | CPU Calculation | --                                                           | type constraint supports float and int64 types. <br/> condition shape is cond_shape, X shape is x_shape, Y shape is y_shape, output shape is o_shape, shape constraints are as follows: <br/>- Only supports cond_shape == o_shape case:  <br/>- x_shape == broadcast of o_shape.  <br/>- y_shape == broadcast of o_shape. <br/>- Only supports cond_shape.NDim() == 4 && o_shape.NDim() == 4 && N dimension values are the same && C dimension values are the same:  <br/>- 1x1 (cond_shape) and HxW (o_shape).  <br/>- Hx1 (cond_shape) and HxW (o_shape).  <br/>- 1xW (cond_shape) and HxW (o_shape). |
| Xor                       | CPU Calculation※ | --                                                           | --                                                           |
| Function                  | CPU Calculation※ | --                                                           | --                                                           |
| Celu                      | CPU Calculation※ | --                                                           | --                                                           |
| DynamicQuantizeLinear     | CPU Calculation※ | --                                                           | --                                                           |
| GreaterOrEqual            | BPU Acceleration        | opset11 does not support a single GreaterOrEqual operator, supports split operators Less+Not running on the BPU, same restrictions as Less. | - Supports calculation with the same input shape. <br/>- Supports calculation where input 1 is a scalar or input 2 is a scalar. <br/>- Supports broadcast calculation with a maximum dimension of 5. |
| MeanVarianceNormalization | CPU Calculation※ | --                                                           | --                                                           |
| GridSample（PyTorch）     | BPU Acceleration | 1. Input dimensions only support 4 dimensions, the first input needs to meet N ∈ [1, 4096]; C ∈ [1, 65536]; H, W ∈ [1, 1024] and H*W <= 720*1024. <br/>2. mode only supports 'bilinear' and 'nearest'. <br/>3. padding_mode only supports 'zeros' and 'border'. <br/>4. This operator is an opset16 onnx operator, not supported in opset11, it is provided by the toolchain as a custom operator for export. To export an onnx model containing this operator, please use the horizon_nn.torch.export_onnx interface instead of torch.onnx.export. The interface parameters are the same, the example code is as follows: <br/>from horizon_nn.torch import export_onnx    <br/>...    <br/>    export_onnx(...) |                                                              |